"use strict";angular.module("myVault",["ui.router","ngResource","ui.bootstrap"]).config(["$stateProvider","$urlRouterProvider",function(e,o){e.state("login",{url:"/",templateUrl:"../views/login.html"}).state("appCommon",{templateUrl:"../views/app_main.html",abstract:!0}).state("app",{url:"/app",parent:"appCommon",views:{"sidebar@appCommon":{templateUrl:"../views/sidebar.html",controller:"SidebarController"},"header@appCommon":{templateUrl:"../views/header.html",controller:"NavbarController"}}}).state("app.pinned",{url:"/pinned",views:{"content@appCommon":{templateUrl:"../views/pinned.html",controller:"PinnedController"}}}).state("app.notes",{url:"/notes",views:{"content@appCommon":{templateUrl:"../views/notes.html",controller:"NotesController"}}}).state("app.passwords",{url:"/passwords",views:{"content@appCommon":{templateUrl:"../views/passwords.html",controller:"PwordsController"}}}).state("app.cards",{url:"/cards",views:{"content@appCommon":{templateUrl:"../views/cards.html",controller:"CardsController"}}}),o.otherwise("/")}]),angular.module("myVault").controller("LoginController",["$scope","loginService","regService",function(e,o,n){e.login=!0,e.regSuccess=e.regFail=e.loginFail=!1,e.user={},e.setLogin=function(o){e.login=o},e.signFb=function(){o.signFb()},e.signIn=function(){e.regSuccess=e.regFail=e.loginFail=!1,o.signIn(e.user.username,e.user.password)},e.signUp=function(){e.regSuccess=e.regFail=e.loginFail=!1,n.signUp(e.user.username,e.user.password)},e.$on("reg-success",function(o,n){console.log("reg-success----\x3e"),e.regSuccess=!0,e.login=!0,o.preventDefault()}),e.$on("reg-fail",function(o,n){console.log("reg-fail----\x3e"),e.regFail=!0,o.preventDefault()}),e.$on("login-fail",function(o,n){console.log("login-fail----\x3e"),e.loginFail=!0,o.preventDefault()})}]).controller("SidebarController",["$scope","$location","notesRepo","pwordsRepo","cardsRepo",function(e,o,n,t,r){e.isActive=function(e){return"/app"+e===o.path()},n.startFetching(),t.startFetching(),r.startFetching()}]).controller("NavbarController",["$scope","action","logoutService","MODE_NEW","msgModal","accService",function(e,o,n,t,r,s){e.account=s.getCurrent(),e.loading=!1,e.setActiveAcc=function(o){e.account=o,s.setCurrent(o),e.$parent.$broadcast("acc-change",o)},e.addNote=function(){o.openNote(e,{account:e.account,pinned:!1},t)},e.addPword=function(){o.openPword(e,{account:e.account,pinned:!1},t)},e.addCard=function(){o.openCard(e,{cardNo:[],account:e.account,pinned:!1},t)},e.signOut=function(){n.signOut()},e.$on("new-msg",function(o,n,t){console.log("<--- received new-msg ---\x3e"),t(r.open(e,n)),o.preventDefault()});var c=0;e.$on("show-loading",function(o){o.preventDefault(),c++||(e.loading=!0)}),e.$on("hide-loading",function(o){o.preventDefault(),--c||(e.loading=!1)}),e.$on("notes-ready")}]).controller("WelcomeController",["$scope","notesRepo","pwordsRepo","cardsRepo","$timeout",function(e,o,n,t,r){r(function(){},1e3)}]).controller("PinnedController",["$scope","notesRepo","pwordsRepo","cardsRepo","action","MODE_EDIT","accService","ops","resources",function(e,o,n,t,r,s,c,a,i){e.account=c.getCurrent(),e.$on("acc-change",function(o,n){e.account=c.getCurrent()}),e.notes=o.get(),e.pwords=n.get(),e.cards=t.get(),e.$on("notes-ready",function(o,n){e.notes=n,o.preventDefault(),console.log("PinnedControl:: Received Notes -----\x3e")}),e.$on("pwords-ready",function(o,n){e.pwords=n,o.preventDefault(),console.log("PinnedControl:: Received Pwords -----\x3e")}),e.$on("cards-ready",function(o,n){e.cards=n,o.preventDefault(),console.log("PinnedControl:: Received Cards -----\x3e")}),e.editNote=function(o){r.openNote(e,o,s)},e.editPword=function(o){r.openPword(e,o,s)},e.editCard=function(o){r.openCard(e,o,s)},e.pinIt=function(e,o){e.pinned=!e.pinned,console.log("PINNED:"),r.pinIt(e,o)},e.delIt=function(o,n){r.delIt(e,o,n),console.log("Deleted: "+o)}}]).controller("NotesController",["$scope","notesRepo","action","MODE_EDIT","accService",function(e,o,n,t,r){e.account=r.getCurrent(),e.$on("acc-change",function(o,n){e.account=r.getCurrent()}),e.notes=o.get(),e.$on("notes-ready",function(o,n){e.notes=n,o.preventDefault(),console.log("NotesControl:: Received Notes -----\x3e")}),e.editNote=function(o){n.openNote(e,o,t)},e.pinIt=function(e){e.pinned=!e.pinned,console.log("PINNED:"),n.pinIt(e,0)},e.delIt=function(o){n.delIt(e,o,0),console.log("Deleted: "+o)}}]).controller("PwordsController",["$scope","pwordsRepo","action","MODE_EDIT","accService",function(e,o,n,t,r){e.account=r.getCurrent(),e.$on("acc-change",function(o,n){e.account=r.getCurrent()}),e.pwords=o.get(),e.$on("pwords-ready",function(o,n){e.pwords=n,o.preventDefault(),console.log("PwordsControl:: Received Pwords -----\x3e")}),e.editPword=function(o){n.openPword(e,o,t)},e.pinIt=function(e){e.pinned=!e.pinned,console.log("PINNED:"),n.pinIt(e,1)},e.delIt=function(o){n.delIt(e,o,1),console.log("Deleted: "+o)}}]).controller("CardsController",["$scope","cardsRepo","action","MODE_EDIT","accService",function(e,o,n,t,r){e.account=r.getCurrent(),e.$on("acc-change",function(o,n){e.account=r.getCurrent()}),e.cards=o.get(),e.$on("cards-ready",function(o,n){e.cards=n,o.preventDefault(),console.log("CardsControl:: Received Cards -----\x3e")}),e.editCard=function(o){n.openCard(e,o,t)},e.pinIt=function(e){e.pinned=!e.pinned,console.log("PINNED:"),n.pinIt(e,2)},e.delIt=function(o){n.delIt(e,o,2),console.log("Deleted: "+o)}}]),angular.module("myVault").constant("MODE_EDIT",0).constant("MODE_NEW",1).constant("BASE_URL","https://vast-citadel-12459.herokuapp.com/").factory("action",["noteModal","pwordModal","cardModal","ops","parse","resources","notesRepo","pwordsRepo","cardsRepo","$timeout",function(e,o,n,t,r,s,c,a,i,l){var u={};return u.openNote=function(o,n,a){var i=e.newNote(o,n),l=s.getNoteResource();i.result.then(function(e){e=r.note(e),a?(console.log("Making New Note!"),t.save(e,l,c)):(console.log("Saving the note!"),t.update(e,l,c))},function(e){console.log("Modal Dismissed")})},u.openPword=function(e,n,c){var i=o.newPword(e,n),l=s.getPwordResource();i.result.then(function(e){e=r.pword(e),c?(console.log("Making New Pword!"),t.save(e,l,a)):(console.log("Saving the pword!"),t.update(e,l,a))},function(e){console.log("Modal Dismissed")})},u.openCard=function(e,o,c){var a=n.newCard(e,o),l=s.getCardResource();a.result.then(function(e){e=r.card(e),c?(console.log("Making New Card!"),t.save(e,l,i)):(console.log("Saving the card!"),t.update(e,l,i))},function(e){console.log("Modal Dismissed")})},u.pinIt=function(e,o){var n={_id:e._id,pinned:e.pinned};switch(o){case 0:t.update(n,s.getNoteResource(),c);break;case 1:t.update(n,s.getPwordResource(),a);break;case 2:t.update(n,s.getCardResource(),i)}},u.delIt=function(e,o,n){switch(n){default:case 0:t.remove(e.nresults[o]._id,s.getNoteResource(),c),e.notes.splice(o,1);break;case 1:t.remove(e.presults[o]._id,s.getPwordResource(),a),e.pwords.splice(o,1);break;case 2:t.remove(e.cresults[o]._id,s.getCardResource(),i),e.cards.splice(o,1)}},u}]).factory("modalOpts",[function(){return{animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",size:"md",controllerAs:"$ctrl"}}]).factory("msgModal",["$uibModal","modalOpts",function(e,o){var n={},t=o;return n.open=function(o,n){return t.templateUrl="../views/modals/msg.html",t.controller="MsgModalController",t.scope=o,t.resolve={msg:n,type:0},e.open(t)},n}]).factory("noteModal",["$uibModal","parse","modalOpts",function(e,o,n){var t={},r=n;return t.newNote=function(n,t){return r.controller="ModalController",r.templateUrl="../views/modals/note.html",r.scope=n,r.resolve={},r.resolve.object=o.note(t),e.open(r)},t}]).factory("pwordModal",["$uibModal","parse","modalOpts",function(e,o,n){var t={},r=n;return t.newPword=function(n,t){return r.controller="ModalController",r.templateUrl="../views/modals/pword.html",r.scope=n,r.resolve={},r.resolve.object=o.pword(t),e.open(r)},t}]).factory("cardModal",["$uibModal","parse","modalOpts",function(e,o,n){var t={},r=n;return t.newCard=function(n,t){return r.controller="ModalController",r.templateUrl="../views/modals/card.html",r.scope=n,r.resolve={},r.resolve.object=o.card(t),e.open(r)},t}]).factory("$localStorage",["$window",function(e){return{store:function(o,n){e.localStorage[o]=n},fetch:function(o,n){return e.localStorage[o]||n},storeObj:function(o,n){e.localStorage[o]=JSON.stringify(n)},fetchObj:function(o,n){return JSON.parse(e.localStorage[o]||n)}}}]).factory("token",["$localStorage",function(e){var o=null,n=!1;return{set:function(t,r){o=t,e.store("token",o),n=r},get:function(){return n?o:o=e.fetch("token",null)}}}]).factory("resources",["BASE_URL","$resource","token",function(e,o,n){var t={};return t.getLoginResource=function(){return o(e+"users/signin",null,{save:{method:"POST"}})},t.getLogoutResource=function(){return o(e+"users/signout",null,{get:{method:"GET",headers:{"x-access-token":n.get()}}})},t.getRegisterResource=function(){return o(e+"users/register",null,{save:{method:"POST"}})},t.getFbResource=function(){return o(e+"users/facebook",null,{get:{method:"GET"}})},t.getNoteResource=function(){return o(e+"notes/:id",null,{update:{method:"PUT",headers:{"x-access-token":n.get()}},get:{method:"GET",headers:{"x-access-token":n.get()}},save:{method:"POST",headers:{"x-access-token":n.get()}},query:{method:"GET",headers:{"x-access-token":n.get()},isArray:!0},remove:{method:"DELETE",headers:{"x-access-token":n.get()}}})},t.getPwordResource=function(){return o(e+"pwords/:id",null,{update:{method:"PUT",headers:{"x-access-token":n.get()}},get:{method:"GET",headers:{"x-access-token":n.get()}},save:{method:"POST",headers:{"x-access-token":n.get()}},query:{method:"GET",headers:{"x-access-token":n.get()},isArray:!0},remove:{method:"DELETE",headers:{"x-access-token":n.get()}}})},t.getCardResource=function(){return o(e+"cards/:id",null,{update:{method:"PUT",headers:{"x-access-token":n.get()}},get:{method:"GET",headers:{"x-access-token":n.get()}},save:{method:"POST",headers:{"x-access-token":n.get()}},query:{method:"GET",headers:{"x-access-token":n.get()},isArray:!0},remove:{method:"DELETE",headers:{"x-access-token":n.get()}}})},t}]).factory("notesRepo",["$rootScope","resources","handle","$state",function(e,o,n,t){var r=[],s=!1,c={},a=function(){e.$broadcast("show-loading"),o.getNoteResource().query().$promise.then(function(o){r=o,s=!0,console.log("<-----notes ready broadcasting now-----\x3e"),e.$broadcast("notes-ready",r),e.$broadcast("hide-loading")},function(o){e.$broadcast("hide-loading"),n("fetch notes",o)})};return c.get=function(){return s||a(),r},c.reset=function(){s=!1,r=[]},c.startFetching=a,c}]).factory("pwordsRepo",["$rootScope","resources","handle",function(e,o,n){var t=[],r=!1,s={},c=function(){e.$broadcast("show-loading"),o.getPwordResource().query().$promise.then(function(o){t=o,r=!0,console.log("<-----pwords ready broadcasting now-----\x3e"),e.$broadcast("pwords-ready",t),e.$broadcast("hide-loading")},function(o){e.$broadcast("hide-loading"),n("fetch passwords",o)})};return s.get=function(){return r||c(),t},s.reset=function(){r=!1,t=[]},s.startFetching=c,s}]).factory("cardsRepo",["$rootScope","resources","handle",function(e,o,n){var t=[],r=!1,s={},c=function(){e.$broadcast("show-loading"),o.getCardResource().query().$promise.then(function(o){t=o,r=!0,e.$broadcast("hide-loading"),console.log("<-----cards ready broadcasting now-----\x3e"),e.$broadcast("cards-ready",t)},function(o){e.$broadcast("hide-loading"),n("fetch cards",o)})};return s.get=function(){return r||c(),t},s.reset=function(){r=!1,t=[]},s.startFetching=c,s}]).factory("handle",["token","$state","$rootScope",function(e,o,n){return function(t,r){var s="";s=401==r.status?null===e.get()?"Unauthorized Access! Please Login/Register!":"Session timedout! Please login again!":"Sorry! Couldn't "+t+"! Please try again!",console.log("<--- broadcasting new-msg ---\x3e"),n.$broadcast("new-msg",{msg:s},function(e){e.result.then(function(e){},function(e){401==r.status&&o.transitionTo("login")})}),console.log("handle -----\x3e",s)}}]).factory("ops",["$state","handle",function(e,o){var n={};return n.save=function(e,n,t){n.save(JSON.stringify(e)).$promise.then(function(e){console.log("Saved!"),t.startFetching()},function(e){console.log(e),console.log("Error Saving!"),o("save",e)})},n.remove=function(e,n,t){n.remove({id:e}).$promise.then(function(o){console.log("Deleted id :",e),t.startFetching()},function(n){console.log("Could not Delete id :",e),o("delete",n)})},n.deleteAll=function(e,n){e.remove().$promise.then(function(e){console.log("Deleted all!"),n.reset()},function(e){console.log("Deletion of all failed!"),o("delete",e)})},n.update=function(e,n,t){n.update({id:e._id},JSON.stringify(e)).$promise.then(function(o){console.log("Updated! id: ",e._id),t.startFetching()},function(n){console.log("Update failed! id: ",e._id),o("update",n)})},n}]).service("parse",[function(){this.note=function(e){var o={title:e.title,note:e.note,pinned:e.pinned,account:e.account};return angular.isUndefined(e._id)||(o._id=e._id),o},this.pword=function(e){var o={title:e.title,username:e.username,password:e.password,pinned:e.pinned,account:e.account,hasCustom:e.hasCustom,customFields:e.customFields};return angular.isUndefined(e._id)||(o._id=e._id),o},this.card=function(e){var o={title:e.title,cardNo:e.cardNo,exp:e.exp,cvv:e.cvv,pinned:e.pinned,account:e.account,hasCustom:e.hasCustom,customFields:e.customFields};return angular.isUndefined(e._id)||(o._id=e._id),o}}]).service("accService",["$localStorage",function(e){var o=!0;this.getCurrent=function(){return console.log("getCurrent---",o),o},this.setCurrent=function(e){console.log("setCurrent---",e),o=e}}]).service("loginService",["resources","token","$rootScope","$state",function(e,o,n,t){var r=e.getLoginResource();this.signIn=function(e,s){var c={username:e,password:s};r.save(JSON.stringify(c)).$promise.then(function(e){console.log("Login Successful!"),console.log(e.token),o.set(e.token,!0),t.transitionTo("app"),t.transitionTo("app.pinned")},function(e){console.log("Login Failed!"),n.$broadcast("login-fail",e)})},this.signFb=function(){e.getFbResource().get().$promise.then(function(e){console.log("Fb login Successful!"),o.set(e.token,!0),t.transitionTo("app")},function(e){console.log("Fb login failed!"),n.$broadcast("login-fail",e)})}}]).service("logoutService",["resources","$state","$timeout","token","notesRepo","pwordsRepo","cardsRepo",function(e,o,n,t,r,s,c){this.signOut=function(){e.getLogoutResource().get(),t.set(null,!1),r.reset(),s.reset(),c.reset(),n(function(){o.transitionTo("login"),n.flush()},10)}}]).service("regService",["resources","$rootScope",function(e,o){var n=e.getRegisterResource();this.signUp=function(e,t){var r={username:e,password:t};n.save(JSON.stringify(r)).$promise.then(function(e){console.log("Registered Successfully!"),o.$broadcast("reg-success",r)},function(e){console.log("Registration Failed!"),o.$broadcast("reg-fail",e)})}}]),angular.module("myVault").controller("ModalController",function($uibModalInstance,object){var $ctrl=this;$ctrl.object=object,$ctrl.setAccount=function(value){$ctrl.object.account=value},$ctrl.save=function(){$uibModalInstance.close($ctrl.object),console.log($ctrl.object)},$ctrl.close=function(){$uibModalInstance.dismiss("cancel")},$ctrl.addField=function(){var field={key:"",value:""};$ctrl.object.hasCustom||($ctrl.object.hasCustom=!0,$ctrl.object.customFields=[]),$ctrl.object.customFields.push(field)},$ctrl.delField=function(index){$ctrl.object.customFields.splice(index,1),$ctrl.fieldShow.splice(index,1),0==$ctrl.object.customFields.length&&($ctrl.object.hasCustom=!1)}}).controller("MsgModalController",function($uibModalInstance,msg,type){var $ctrl=this;$ctrl.type=type,$ctrl.msg=msg.msg,$ctrl.close=function(){$uibModalInstance.dismiss("cancel")}});