"use strict";angular.module("myVault",["ui.router","ngResource","ui.bootstrap"]).config(["$stateProvider","$urlRouterProvider",function(e,o){e.state("login",{url:"/",templateUrl:"../views/login.html"}).state("appCommon",{templateUrl:"../views/app_main.html",abstract:!0}).state("welcome",{url:"/welcome",parent:"appCommon",views:{"sidebar@appCommon":{templateUrl:"../views/sidebar.html",controller:"SidebarController"},"header@appCommon":{templateUrl:"../views/header.html",controller:"NavbarController"},"content@appCommon":{templateUrl:"../views/welcome.html",controller:"WelcomeController"}}}).state("pinned",{url:"/pinned",parent:"appCommon",views:{"sidebar@appCommon":{templateUrl:"../views/sidebar.html",controller:"SidebarController"},"header@appCommon":{templateUrl:"../views/header.html",controller:"NavbarController"},"content@appCommon":{templateUrl:"../views/pinned.html",controller:"PinnedController"}}}).state("notes",{url:"/notes",parent:"appCommon",views:{"sidebar@appCommon":{templateUrl:"../views/sidebar.html",controller:"SidebarController"},"header@appCommon":{templateUrl:"../views/header.html",controller:"NavbarController"},"content@appCommon":{templateUrl:"../views/notes.html",controller:"NotesController"}}}).state("passwords",{url:"/passwords",parent:"appCommon",views:{"sidebar@appCommon":{templateUrl:"../views/sidebar.html",controller:"SidebarController"},"header@appCommon":{templateUrl:"../views/header.html",controller:"NavbarController"},"content@appCommon":{templateUrl:"../views/passwords.html",controller:"PwordsController"}}}).state("cards",{url:"/cards",parent:"appCommon",views:{"sidebar@appCommon":{templateUrl:"../views/sidebar.html",controller:"SidebarController"},"header@appCommon":{templateUrl:"../views/header.html",controller:"NavbarController"},"content@appCommon":{templateUrl:"../views/cards.html",controller:"CardsController"}}}),o.otherwise("/")}]),angular.module("myVault").controller("LoginController",["$scope","loginService","regService",function(e,o,t){e.login=!0,e.regSuccess=e.regFail=e.loginFail=!1,e.user={},e.setLogin=function(o){e.login=o},e.signIn=function(){e.regSuccess=e.regFail=e.loginFail=!1,o.signIn(e.user.username,e.user.password)},e.signUp=function(){e.regSuccess=e.regFail=e.loginFail=!1,t.signUp(e.user.username,e.user.password)},e.$on("reg-success",function(o,t){console.log("reg-success----\x3e"),e.regSuccess=!0,e.login=!0,o.preventDefault()}),e.$on("reg-fail",function(o,t){console.log("reg-fail----\x3e"),e.regFail=!0,o.preventDefault()}),e.$on("login-fail",function(o,t){console.log("login-fail----\x3e"),e.loginFail=!0,o.preventDefault()})}]).controller("SidebarController",["$scope","$location",function(e,o){e.isActive=function(e){return e===o.path()}}]).controller("NavbarController",["$scope","action","logoutService","MODE_NEW","msgModal","accService",function(e,o,t,n,r,s){e.addNote=function(){o.openNote(e,{account:s.getCurrent(),pinned:!1},n)},e.addPword=function(){o.openPword(e,{account:s.getCurrent(),pinned:!1},n)},e.addCard=function(){o.openCard(e,{cardNo:[],account:s.getCurrent(),pinned:!1},n)},e.signOut=function(){t.signOut()},e.$on("new-msg",function(o,t,n){console.log("<--- received new-msg ---\x3e"),n(r.open(e,t)),o.preventDefault()})}]).controller("WelcomeController",["notesRepo","pwordsRepo","cardsRepo","$timeout",function(e,o,t,n){n(function(){e.startFetching(),o.startFetching(),t.startFetching()},1e3)}]).controller("PinnedController",["$scope","notesRepo","pwordsRepo","cardsRepo","action","MODE_EDIT","accService","ops","resources",function(e,o,t,n,r,s,c,a,l){e.account=c.getCurrent(),e.setActiveAcc=function(o){e.account=o,c.setCurrent(o)},e.notes=o.get(),e.pwords=t.get(),e.cards=n.get(),e.$on("notes-ready",function(o,t){e.notes=t,o.preventDefault(),console.log("PinnedControl:: Received Notes -----\x3e")}),e.$on("pwords-ready",function(o,t){e.pwords=t,o.preventDefault(),console.log("PinnedControl:: Received Pwords -----\x3e")}),e.$on("cards-ready",function(o,t){e.cards=t,o.preventDefault(),console.log("PinnedControl:: Received Cards -----\x3e")}),e.editNote=function(o){r.openNote(e,o,s)},e.editPword=function(o){r.openPword(e,o,s)},e.editCard=function(o){r.openCard(e,o,s)},e.pinIt=function(e,o){e.pinned=!e.pinned,console.log("PINNED:"),r.pinIt(e,o)},e.delIt=function(o,t){r.delIt(e,o,t),console.log("Deleted: "+o)}}]).controller("NotesController",["$scope","notesRepo","action","MODE_EDIT","accService",function(e,o,t,n,r){e.account=r.getCurrent(),e.setActiveAcc=function(o){e.account=o,r.setCurrent(o)},e.notes=o.get(),e.$on("notes-ready",function(o,t){e.notes=t,o.preventDefault(),console.log("NotesControl:: Received Notes -----\x3e")}),e.editNote=function(o){t.openNote(e,o,n)},e.pinIt=function(e){e.pinned=!e.pinned,console.log("PINNED:"),t.pinIt(e,0)},e.delIt=function(o){t.delIt(e,o,0),console.log("Deleted: "+o)}}]).controller("PwordsController",["$scope","pwordsRepo","action","MODE_EDIT","accService",function(e,o,t,n,r){e.account=r.getCurrent(),e.setActiveAcc=function(o){e.account=o,r.setCurrent(o)},e.pwords=o.get(),e.$on("pwords-ready",function(o,t){e.pwords=t,o.preventDefault(),console.log("PwordsControl:: Received Pwords -----\x3e")}),e.editPword=function(o){t.openPword(e,o,n)},e.pinIt=function(e){e.pinned=!e.pinned,console.log("PINNED:"),t.pinIt(e,1)},e.delIt=function(o){t.delIt(e,o,1),console.log("Deleted: "+o)}}]).controller("CardsController",["$scope","cardsRepo","action","MODE_EDIT","accService",function(e,o,t,n,r){e.account=r.getCurrent(),e.setActiveAcc=function(o){e.account=o,r.setCurrent(o)},e.cards=o.get(),e.$on("cards-ready",function(o,t){e.cards=t,o.preventDefault(),console.log("CardsControl:: Received Cards -----\x3e")}),e.editCard=function(o){t.openCard(e,o,n)},e.pinIt=function(e){e.pinned=!e.pinned,console.log("PINNED:"),t.pinIt(e,2)},e.delIt=function(o){t.delIt(e,o,2),console.log("Deleted: "+o)}}]),angular.module("myVault").constant("MODE_EDIT",0).constant("MODE_NEW",1).constant("BASE_URL","https://vast-citadel-12459.herokuapp.com/").factory("action",["noteModal","pwordModal","cardModal","ops","parse","resources","notesRepo","pwordsRepo","cardsRepo",function(e,o,t,n,r,s,c,a,l){var i={};return i.openNote=function(o,t,a){var l=e.newNote(o,t),i=s.getNoteResource();l.result.then(function(e){e=r.note(e),a?(console.log("Making New Note!"),n.save(e,i)):(console.log("Saving the note!"),n.update(e,i)),c.startFetching()},function(e){console.log("Modal Dismissed")})},i.openPword=function(e,t,c){var l=o.newPword(e,t),i=s.getPwordResource();l.result.then(function(e){e=r.pword(e),c?(console.log("Making New Pword!"),n.save(e,i)):(console.log("Saving the pword!"),n.update(e,i)),a.startFetching()},function(e){console.log("Modal Dismissed")})},i.openCard=function(e,o,c){var a=t.newCard(e,o),i=s.getCardResource();a.result.then(function(e){e=r.card(e),c?(console.log("Making New Card!"),n.save(e,i)):(console.log("Saving the card!"),n.update(e,i)),l.startFetching()},function(e){console.log("Modal Dismissed")})},i.pinIt=function(e,o){var t,r,i;switch(r={_id:e._id,pinned:e.pinned},o){case 0:t=s.getNoteResource(),i=c;break;case 1:t=s.getPwordResource(),i=a;break;case 2:t=s.getCardResource(),i=l}n.update(r,t),i.startFetching()},i.delIt=function(e,o,t){var r,i,d;switch(t){default:case 0:r=e.notes[o]._id,i=s.getNoteResource(),e.notes.splice(o,1),d=c;break;case 1:r=e.pwords[o]._id,i=s.getPwordResource(),e.pwords.splice(o,1),d=a;break;case 2:r=e.cards[o]._id,i=s.getCardResource(),e.cards.splice(o,1),d=l}n.remove(r,i),d.startFetching()},i}]).factory("modalOpts",[function(){return{animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",size:"md",controllerAs:"$ctrl"}}]).factory("msgModal",["$uibModal","modalOpts",function(e,o){var t={},n=o;return t.open=function(o,t){return n.templateUrl="../views/modals/msg.html",n.controller="MsgModalController",n.scope=o,n.resolve={msg:t,type:0},e.open(n)},t}]).factory("noteModal",["$uibModal","parse","modalOpts",function(e,o,t){var n={},r=t;return n.newNote=function(t,n){return r.controller="ModalController",r.templateUrl="../views/modals/note.html",r.scope=t,r.resolve={},r.resolve.object=o.note(n),e.open(r)},n}]).factory("pwordModal",["$uibModal","parse","modalOpts",function(e,o,t){var n={},r=t;return n.newPword=function(t,n){return r.controller="ModalController",r.templateUrl="../views/modals/pword.html",r.scope=t,r.resolve={},r.resolve.object=o.pword(n),e.open(r)},n}]).factory("cardModal",["$uibModal","parse","modalOpts",function(e,o,t){var n={},r=t;return n.newCard=function(t,n){return r.controller="ModalController",r.templateUrl="../views/modals/card.html",r.scope=t,r.resolve={},r.resolve.object=o.card(n),e.open(r)},n}]).factory("$localStorage",["$window",function(e){return{store:function(o,t){e.localStorage[o]=t},fetch:function(o,t){return e.localStorage[o]||t},storeObj:function(o,t){e.localStorage[o]=JSON.stringify(t)},fetchObj:function(o,t){return JSON.parse(e.localStorage[o]||t)}}}]).factory("token",["$localStorage",function(e){var o=null,t=!1;return{set:function(n,r){o=n,e.store("token",o),t=r},get:function(){return t?o:o=e.fetch("token",null)}}}]).factory("resources",["BASE_URL","$resource","token",function(e,o,t){var n={};return n.getLoginResource=function(){return o(e+"users/signin",null,{save:{method:"POST"}})},n.getLogoutResource=function(){return o(e+"users/signout",null,{get:{method:"GET",headers:{"x-access-token":t.get()}}})},n.getRegisterResource=function(){return o(e+"users/register",null,{save:{method:"POST"}})},n.getNoteResource=function(){return o(e+"notes/:id",null,{update:{method:"PUT",headers:{"x-access-token":t.get()}},get:{method:"GET",headers:{"x-access-token":t.get()}},save:{method:"POST",headers:{"x-access-token":t.get()}},query:{method:"GET",headers:{"x-access-token":t.get()},isArray:!0},remove:{method:"DELETE",headers:{"x-access-token":t.get()}}})},n.getPwordResource=function(){return o(e+"pwords/:id",null,{update:{method:"PUT",headers:{"x-access-token":t.get()}},get:{method:"GET",headers:{"x-access-token":t.get()}},save:{method:"POST",headers:{"x-access-token":t.get()}},query:{method:"GET",headers:{"x-access-token":t.get()},isArray:!0},remove:{method:"DELETE",headers:{"x-access-token":t.get()}}})},n.getCardResource=function(){return o(e+"cards/:id",null,{update:{method:"PUT",headers:{"x-access-token":t.get()}},get:{method:"GET",headers:{"x-access-token":t.get()}},save:{method:"POST",headers:{"x-access-token":t.get()}},query:{method:"GET",headers:{"x-access-token":t.get()},isArray:!0},remove:{method:"DELETE",headers:{"x-access-token":t.get()}}})},n}]).factory("notesRepo",["$rootScope","resources","handle","$state",function(e,o,t,n){var r=[],s=!1,c={},a=function(){o.getNoteResource().query().$promise.then(function(o){r=o,s=!0,console.log("<-----notes ready broadcasting now-----\x3e"),e.$broadcast("notes-ready",r)},function(e){t("fetch notes",e)})};return c.get=function(){return s||a(),r},c.startFetching=function(){a()},c}]).factory("pwordsRepo",["$rootScope","resources","handle",function(e,o,t){var n=[],r=!1,s={};s.get=function(){return r||c(),n};var c=function(){o.getPwordResource().query().$promise.then(function(o){n=o,r=!0,console.log("<-----pwords ready broadcasting now-----\x3e"),e.$broadcast("pwords-ready",n)},function(e){t("fetch passwords",e)})};return s.startFetching=function(){c()},s}]).factory("cardsRepo",["$rootScope","resources","handle",function(e,o,t){var n=[],r=!1,s={};s.get=function(){return r||c(),n};var c=function(){o.getCardResource().query().$promise.then(function(o){n=o,r=!0,console.log("<-----cards ready broadcasting now-----\x3e"),e.$broadcast("cards-ready",n)},function(e){t("fetch cards",e)})};return s.startFetching=function(){c()},s}]).factory("handle",["token","$state","$rootScope",function(e,o,t){return function(n,r){var s="";s=401==r.status?null===e.get()?"Unauthorized Access! Please Login/Register!":"Session timedout! Please login again!":"Sorry! Couldn't "+n+"! Please try again!",console.log("<--- broadcasting new-msg ---\x3e"),t.$broadcast("new-msg",{msg:s},function(e){e.result.then(function(e){},function(e){401==r.status&&o.transitionTo("login")})}),console.log("handle -----\x3e",s)}}]).factory("ops",["$state","handle",function(e,o){var t={};return t.save=function(e,t){t.save(JSON.stringify(e)).$promise.then(function(e){console.log("Saved!")},function(e){console.log(e),console.log("Error Saving!"),o("save",e)})},t.remove=function(e,t){t.remove({id:e}).$promise.then(function(o){console.log("Deleted id :",e)},function(t){console.log("Could not Delete id :",e),o("delete",t)})},t.deleteAll=function(e){e.remove().$promise.then(function(e){console.log("Deleted all!")},function(e){console.log("Deletion of all failed!"),o("delete",e)})},t.update=function(e,t){t.update({id:e._id},JSON.stringify(e)).$promise.then(function(o){console.log("Updated! id: ",e._id)},function(t){console.log("Update failed! id: ",e._id),o("update",t)})},t}]).service("parse",[function(){this.note=function(e){var o={title:e.title,note:e.note,pinned:e.pinned,account:e.account};return angular.isUndefined(e._id)||(o._id=e._id),o},this.pword=function(e){var o={title:e.title,username:e.username,password:e.password,pinned:e.pinned,account:e.account,hasCustom:e.hasCustom,customFields:e.customFields};return angular.isUndefined(e._id)||(o._id=e._id),o},this.card=function(e){var o={title:e.title,cardNo:e.cardNo,expMonth:e.expMonth,expYear:e.expYear,pinned:e.pinned,account:e.account,hasCustom:e.hasCustom,customFields:e.customFields};return angular.isUndefined(e._id)||(o._id=e._id),o}}]).service("accService",["$localStorage",function(e){var o=!0;this.getCurrent=function(){return console.log("getCurrent---",o),o},this.setCurrent=function(e){console.log("setCurrent---",e),o=e}}]).service("loginService",["resources","token","$rootScope","$state",function(e,o,t,n){var r=e.getLoginResource();this.signIn=function(e,s){var c={username:e,password:s};r.save(JSON.stringify(c)).$promise.then(function(e){console.log("Login Successful!"),console.log(e.token),o.set(e.token,!0),n.transitionTo("welcome")},function(e){console.log("Login Failed!"),t.$broadcast("login-fail",e)})}}]).service("logoutService",["resources","$state","$timeout","token",function(e,o,t,n){this.signOut=function(){e.getLogoutResource().get(),n.set(null,!1),t(function(){o.transitionTo("login")},10)}}]).service("regService",["resources","$rootScope",function(e,o){var t=e.getRegisterResource();this.signUp=function(e,n){var r={username:e,password:n};t.save(JSON.stringify(r)).$promise.then(function(e){console.log("Registered Successfully!"),o.$broadcast("reg-success",r)},function(e){console.log("Registration Failed!"),o.$broadcast("reg-fail",e)})}}]),angular.module("myVault").controller("ModalController",function($uibModalInstance,object){var $ctrl=this;$ctrl.object=object,$ctrl.show=!1,$ctrl.setAccount=function(value){$ctrl.object.account=value},$ctrl.save=function(){$uibModalInstance.close($ctrl.object)},$ctrl.close=function(){$uibModalInstance.dismiss("cancel")},$ctrl.addField=function(){var field={key:"",value:""};$ctrl.object.hasCustom||($ctrl.object.hasCustom=!0,$ctrl.object.customFields=[]),$ctrl.object.customFields.push(field)},$ctrl.delField=function(index){$ctrl.object.customFields.splice(index,1),$ctrl.fieldShow.splice(index,1),0==$ctrl.object.customFields.length&&($ctrl.object.hasCustom=!1)}}).controller("MsgModalController",function($uibModalInstance,msg,type){var $ctrl=this;$ctrl.type=type,$ctrl.msg=msg.msg,$ctrl.close=function(){$uibModalInstance.dismiss("cancel")}});